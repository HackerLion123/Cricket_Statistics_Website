AdsPlugin=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=/windows phone/i.test(navigator.userAgent),w=/iPhone/i.test(navigator.userAgent)&&!v,x=/iPod/i.test(navigator.userAgent)&&!v,y=!1,z=!1,A=[],B="en",C=function(){},D=!1,E=!1,F=!1,G=!1,H=!1,I=!1,J=!1,K=!0,L=!1,M=!1,N=!1,O=!1,P=!1,Q="adsPlugin",R={en:"ADVERTISEMENT",pl:"REKLAMA",da:"REKLAME",nl:"ADVERTENTIE",fi:"MAINOS",fr:"RÉCLAME",de:"ANKÜNDIGUNG",id:"ADPERTENSI",it:"INSERZIONE",ja:"広告",nn:"ANNONSE",pt:"PROPAGANDA",es:"RECLAMO",sw:"TANGAZO",sv:"REKLAM"},S=function(){return{playlistLoading:X,playlistLoaded:Z,userPlay:$,playing:_,ended:aa,resize:ba,fullscreenEnter:V,fullscreenExit:W,error:Y,"bbc.smp.plugins.ads.event.updateAdTag":da,"bbc.smp.plugins.preview.complete":U,pluginLoaded:T}},T=function(b){-1===b.url.indexOf("dfpAds")&&(A=a.datastore.get("plugins").slice()),Qa()},U=function(a){O=!0,!0!==g.hasAds&&!0!==y||(D=!0,ea())},V=function(a){J=!0,wa(p,"ads_exitFullScreenButton","Exit Full Screen","22","22","0 0 32 32","fullscreen-return"),setTimeout(ca,510)},W=function(a){J=!1,wa(p,"ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),setTimeout(ca,510)},X=function(a){ta(!0),g=null,D=!1,E=!1,L=!1,F=!1,G=!1,H=!1,I=!1,O=!1,P=!1},Y=function(a){"critical"==a.severity&&X()},Z=function(a){g||(g=a.playlist,!0!==g.hasAds&&!0!==y||(D=!0,ea()))},$=function(a){!0===D&&!1===F&&(s.initialize(),L=!0)},_=function(a){N&&!O||!0===D&&!1===F&&(L||(L=!0,s.initialize()),fa())},aa=function(a){I=!0,!0===D&&!1===H?(K=!1,za(),Ba(),t.contentComplete()):(w||x)&&f.webkitExitFullScreen()},ba=function(a){ca()},ca=function(){u&&u.resize(l.clientWidth,l.clientHeight,J?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},da=function(a){b=a.data.adTag},ea=function(){N&&!O||(a.pauseAt([0]),E||(E=!0,C()))},fa=function(){K=!1,za(),Ba(),a.datastore.set({name:"adsPlaying",data:!0});var c=new google.ima.AdsRequest;c.adTagUrl=b,c.linearAdSlotWidth=l.clientWidth,c.linearAdSlotHeight=l.clientHeight,c.nonLinearAdSlotWidth=l.clientWidth,c.nonLinearAdSlotHeight=l.clientHeight,t.requestAds(c),a.dispatchEvent({type:Q,id:"adRequest"}),F=!0},ga=function(b){a.dispatchEvent({type:Q,id:"adManagerLoaded"});var c=new google.ima.AdsRenderingSettings;c.uiElements=[],u=b.getAdsManager(f,c),u.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,pa),u.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,qa),u.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,sa),u.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,ra),u.addEventListener(google.ima.AdEvent.Type.LOADED,ka),u.addEventListener(google.ima.AdEvent.Type.COMPLETE,oa),u.addEventListener(google.ima.AdEvent.Type.STARTED,ma),u.addEventListener(google.ima.AdEvent.Type.CLICK,ua),u.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,la),u.addEventListener(google.ima.AdEvent.Type.IMPRESSION,na),u.addEventListener(google.ima.AdEvent.Type.LOG,ja),u.addEventListener(google.ima.AdEvent.Type.PAUSED,ha),u.addEventListener(google.ima.AdEvent.Type.RESUMED,ia);try{u.init(l.clientWidth,l.clientHeight,google.ima.ViewMode.NORMAL),u.start()}catch(a){ta()}},ha=function(a){!1===M&&(wa(o,"ads_playButton","Play","31","31","0 0 44 44","play"),clearInterval(i),G=!0)},ia=function(a){!1===M&&!0===G&&(wa(o,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),i=setInterval(Fa,250),G=!1)},ja=function(b){var c=b.getAdData();if(c&&c.adError){var d=c.adError;a.dispatchEvent({type:Q,id:"adError",code:d.getErrorCode(),msg:d.getMessage()})}},ka=function(b){var c=b.getAd();h=c.getDuration(),a.dispatchEvent({type:Q,id:"adDuration",duration:h})},la=function(b){b.getAd().getDuration()>0&&(h=b.getAd().getDuration(),a.dispatchEvent({type:Q,id:"adDuration",duration:h}))},ma=function(b){a.dispatchEvent({type:Q,id:"adStarted"}),Aa(),Da(),-1==o.className.indexOf("ads_pauseButton")&&wa(o,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),Fa(),i=setInterval(Fa,250)},na=function(b){a.dispatchEvent({type:Q,id:"adImpression"})},oa=function(b){a.datastore.set({name:"adsPlaying",data:!1}),a.dispatchEvent({type:Q,id:"adEnded"}),ta()},pa=function(){ta()},qa=function(){},ra=function(){K||ta(),u&&u.destroy(),H=!0,a.datastore.set({name:"adsPlaying",data:!1}),a.dispatchEvent({type:"bbc.smp.plugins.ads.event.AdsPluginExternalEvent.ALL_ADS_COMPLETED"})},sa=function(b){var c=b.getError();a.dispatchEvent({type:Q,id:"adError",code:c.getErrorCode(),msg:c.getMessage()}),ta(),ra()},ta=function(b){K||(Aa(),Ca(),ya(),clearInterval(i),a.pauseAt([]),b?u&&u.destroy():I||a.play(!0),K=!0)},ua=function(){G||Ka()},va=function(a,b,c,d,e,f,g){var h=document.createElement("button");h.id=a,h.className=b,h.title=c;var i=document.createElement("span");i.className="ads_hiddenElement",i.innerHTML=c,i.setAttribute("aria-hidden","true"),h.appendChild(i);var j=document.createElementNS("http://www.w3.org/2000/svg","svg");j.setAttribute("width",d),j.setAttribute("height",e),j.setAttribute("viewBox",f);var k=document.createElementNS("http://www.w3.org/2000/svg","use");return k.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+g),j.appendChild(k),h.appendChild(j),h},wa=function(a,b,c,d,e,f,g){a.className=b,a.title=c;var h=a.getElementsByClassName("ads_hiddenElement")[0];h&&(h.innerHTML=c);var i=a.getElementsByTagName("svg")[0];i.setAttribute("width",d),i.setAttribute("height",e),i.setAttribute("viewBox",f);var j=a.getElementsByTagName("use")[0];j&&j.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+g)},xa=function(){j=document.createElement("div"),j.id="ads_adsUX",j.style.display="none",Ea(),l=document.createElement("div"),l.id="ads_adContainer",j.appendChild(l),_bottomFade=document.createElement("div"),_bottomFade.id="ads_bottomFade",_bottomFade.style.display="none",j.appendChild(_bottomFade),_controlsContainer=document.createElement("div"),_controlsContainer.id="ads_controlsContainer",_controlsContainer.style.display="none",j.appendChild(_controlsContainer),m=document.createElement("div"),m.id="ads_seekBar",n=document.createElement("div"),n.id="ads_progressBar",n.style.backgroundColor=c,m.appendChild(n),_controlsContainer.appendChild(m);var b=document.createElement("div");b.id="ads_buttonBar",_controlsContainer.appendChild(b),o=va("ads_playPauseButton","ads_pauseButton","Pause","31","31","0 0 44 44","pause"),Ha(o,Ka,Ia,Ja,!0),b.appendChild(o),p=va("ads_fullScreenButton","ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),Ha(p,La,Ia,Ja,!0),b.appendChild(p),q=document.createElement("div"),q.id="ads_countdownText";var d=document.createElement("span");B=a.settings.ui.locale.lang;var e={"en-GB":"en","en-gb":"en","cy-GB":"cy","cy-gb":"cy","gd-GB":"gd","gd-gb":"gd","ga-GB":"ga","ga-gb":"ga","ru-uk":"ru",zh:"zh-hans"};e[B]&&(B=e[B]);var f=R[B]?R[B]:R.en;d.innerHTML=f+" ",q.appendChild(d),r=document.createElement("span"),r.innerHTML="00:00",q.appendChild(r),b.appendChild(q),a.container.appendChild(j)},ya=function(){j&&(j.style.display="none"),a.updateUiConfig({controls:{enabled:!0},cta:{enabled:!0}})},za=function(){a.updateUiConfig({controls:{enabled:!1},cta:{enabled:!1}}),j&&(j.style.display="block")},Aa=function(){k&&(k.style.display="none")},Ba=function(){k&&(k.style.display="block")},Ca=function(){_controlsContainer&&(_controlsContainer.style.display="none",_bottomFade.style.display="none")},Da=function(){_controlsContainer&&(_controlsContainer.style.display="block",_bottomFade.style.display="block")},Ea=function(){k=document.createElement("div"),k.id="ads_spinner",k.style.width="62px",k.style.height="62px",k.style.marginLeft="-31px",k.style.marginTop="-31px",k.style.top="50%",k.style.left="50%",k.style.display="none";var a=document.createElement("canvas"),b=new Sonic(a);b.width=50,b.height=50,b.colour=c,b.thickness=10,b.draw(),k.appendChild(a),j.appendChild(k)},Fa=function(){var a=u.getRemainingTime();P||a>h&&(h=a,P=!0);var b=(h-a)/h;if(r.innerHTML=Ga(a),!(m.clientWidth<50||isNaN(b))){var c=100*b;n.style.width=c+"%"}},Ga=function(a){(a=Math.round(a))<0&&(a=0);var b=a/60,c=Math.floor(b%60),d=Math.floor(a%60);return c<10&&(c="0"+c),d<10&&(d="0"+d),[c,d].join(":")},Ha=function(a,b,c,d,e){var f=!1;!1!==e&&(e=!0),a.addEventListener("touchstart",function(a){f=!0,setTimeout(function(){f=!1},500)}),b&&a.addEventListener("click",function(c){return b.bind(a)(c,f)}),c&&(a.addEventListener("mouseenter",function(b){if(!f)return c.bind(a)(b,f)}),a.addEventListener("focus",function(b){if(!f)return c.bind(a)(b,f)}),e&&a.addEventListener("touchstart",function(b){return c.bind(a)(b,f)})),d&&(a.addEventListener("mouseleave",function(b){if(!f)return d.bind(a)(b,f)}),a.addEventListener("blur",function(b){return d.bind(a)(b,f)}),e&&document.addEventListener("touchend",function(b){return d.bind(a)(b,f)}))},Ia=function(a){this.style.backgroundColor=c,this.style.fill=d},Ja=function(a){this.style.backgroundColor="",this.style.fill=""},Ka=function(){M=!0,setTimeout(function(){M=!1},100),G?(wa(o,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),u.resume(),i=setInterval(Fa,250)):(wa(o,"ads_playButton","Play","31","31","0 0 44 44","play"),u.pause(),clearInterval(i)),G=!G},La=function(){a.toggleFullscreen()},Ma=function(a){if(window.google&&window.google.ima)a();else{var b=document.createElement("script");b.async=!0,b.type="text/javascript",b.onload=function(){a()},b.src=document.location.protocol+(!0===z?"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js":"//imasdk.googleapis.com/js/sdkloader/ima3.js"),document.getElementsByTagName("head")[0].appendChild(b)}},Na=function(){Oa(),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(B),f=a.requestVideoElement(!0),s=new google.ima.AdDisplayContainer(l),t=new google.ima.AdsLoader(s),t.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,ga),t.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,sa),a.listenerObject=S();var b=a.playlist;if(b){Z({playlist:b})}a.addContextMenuItem("AdsPluginHTML","AdsPluginHTML.3.24.1")},Oa=function(){clearTimeout(e),a.updateUiConfig({cta:{enabled:!0}})},Pa=function(){var b={id:"dfpAds",version:"3.24.1"},c=a.datastore.get("plugins");if(c){var d=c.slice();d.push(b),A=d}else A=[b];a.datastore.set({name:"plugins",data:A.slice()}),Qa()},Qa=function(){for(var a=0;a<A.length;a++)"PreviewPluginHTML"===A[a].id&&(N=!0)};return{pluginInitialisation:function(f){a=f.playerInterface,Pa(),a.listenerObject={pluginLoaded:T};var g=a.datastore.get("AdsPluginParameters");g||(g={}),a.updateUiConfig({cta:{enabled:!1}}),f.loadCSS(g.cssPath?g.cssPath:"../css/dfpAds.css"),y=!!g.pretendPlaylistHasAds,b=g.adTag,z=!!g.debug,c=a.settings.ui.colour,d=a.settings.ui.foreColour,C="function"==typeof g.setupCompanionAds?g.setupCompanionAds:function(){},xa(),e=setTimeout(function(){Oa()},5e3),Ma(Na)},reset:function(){X()}}}();var runPlugin=function(a,b){return AdsPlugin};