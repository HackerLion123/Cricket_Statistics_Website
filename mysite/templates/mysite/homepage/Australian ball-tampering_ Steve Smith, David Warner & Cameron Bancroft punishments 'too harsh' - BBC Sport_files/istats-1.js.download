define("istats-1",[],function(){function e(e){return"undefined"==typeof e.istats&&(e.istats={}),"undefined"==typeof e.istats.enabled&&(e.istats.enabled=!0),e}function t(t){return t?e(t).istats:window.istats}function n(e){return"function"==typeof e&&(J?e():z.push(e)),J}function r(){if("string"==typeof fe)return Y.type="internal",i(decodeURIComponent(fe))}function o(e){return e=e.replace(/\+/g,"%20"),decodeURIComponent(e)}function i(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].split("=");t[o[0]]=o[1]}return t}function a(e){if(history.replaceState){var t=location.protocol+"//"+location.host+(location.pathname?location.pathname:"");try{history.replaceState({},"",t+e)}catch(e){window.console&&console.log&&console.log(e)}}else location.hash=e}function c(e){if(e||(e=location.hash),""!==e){var t,n=e.match(oe.clickThrough),r="",c=[];if(null===n)return;if(n[2]&&(r="#"+n[2]),a(r),t=n[1],""===t)return;return Y.type="click through",c=i(o(t))}}function s(){var e=!0,n=!0,r=t().enabled;return window.bbcFlagpoles_istats&&(n=!("ON"===window.bbcFlagpoles_istats)),!n&&r||(e=!1),e}function l(){var e=window.location.pathname.replace(/\/$/,"").replace(/^\//,"").replace(/\//g,".");return e+".page"}function u(e){if("string"!=typeof e)throw Error("'site' must be a string");return e=e.toLowerCase().replace(/_/g,"-")}function f(e,t){return!!e.className&&(" "+e.className+" ").indexOf(" "+t+" ")!==-1}function d(e,t){var n=e.className?e.className+" ":"";f(e,t)||(e.className=n+t)}function p(e,t){for(var n=e.className.split(" "),r=[],o=n.length;o--;)n[o]!==t&&r.unshift(n[o]);e.className=r.length?r.join(" "):""}function h(e){var t=e.match(oe.domain);return t?t[1]:e.replace(/:\d+$/,"")}function g(e,t){t=t||"&";var n=[];e.hasOwnProperty("name")&&n.push(encodeURIComponent("name")+"="+encodeURIComponent(e.name));for(var r in e)e.hasOwnProperty(r)&&"object"!=typeof e[r]&&("linkLocation"===r?n.push(encodeURIComponent("link_location")+"="+encodeURIComponent(e[r])):"name"!==r&&"ns_referrer"!==r&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r])));return e.hasOwnProperty("ns_referrer")&&n.push(encodeURIComponent("ns_referrer")+"="+encodeURIComponent(e.ns_referrer)),n.join(t)}function m(e){"string"==typeof e&&(e=i(o(e))),v(H,e)}function v(e,t){for(var n in t)e[n]=t[n];return e}function k(){return E("ckpf_sa_labels_persist")}function _(e){x("ckpf_sa_labels_persist",e)}function w(){var e={},t=k();if(t)try{e=JSON.parse(t)}catch(t){e={}}return e}function y(e,t){var n=e;do{if("A"==n.nodeName)return n;if(n===t)return!1}while(n=n.parentNode)}function b(e){if(W._isWebUrl(e))return W._isExternal(e)?"external":W._isDownload(e)?"download":W._isInternal(e)?"internal":void 0}function T(e,t,n,r,o){e.istats=e.istats||{},e.istats.linkType=t,e.istats.linkTrackerUrl=n,e.istats.linkLocation=r,e.istats.linkElement=o}function U(e){for(var t={};e;){if(e.linktrack){"string"==typeof e.linktrack&&(t=i(o(e.linktrack))),"object"==typeof e.linktrack&&(t=e.linktrack);break}e=e.parentNode}return t}function C(e,t,n,r){var o=r.altKey||r.ctrlKey||r.metaKey||r.shiftKey,i=function(){},a=o||n.target&&!n.target.match(/^_(self|parent|top)$/i);a||(i=function(){ae.notify(t,"redirect.istats",r)!==!1&&(window.location.href=n.href)}),clearTimeout(re),re=setTimeout(function(){ae.notify(t,"trackingfail.istats",r),i()},ee),R(e,function(){clearTimeout(re),ae.notify(t,"trackingsuccess.istats",r)!==!1&&i()},r),a||(r.preventDefault?r.preventDefault():event.returnValue=!1)}function L(e){"undefined"==typeof e[Q]&&(e[Q]={eventsKey:le.length,linkTypesTracked:{}},le.push(ue()))}function x(e,t,n){var r,o,i,a=new Date,c=31536e6,s=window.location.host;return"undefined"==typeof n&&(n=c),a.setTime(a.getTime()+n),o="; expires="+a.toGMTString(),r=h(s),i=e+"="+t+o+"; domain="+r+"; path=/",document.cookie=i,i}function E(e){for(var t,n=e+"=",r=document.cookie.split(";"),o=0,i=r.length;o<i;o++){for(t=r[o];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(n))return decodeURIComponent(t.substring(n.length,t.length))}return null}function I(e){null!==E(e)&&x(e,"",-1)}function D(e){"undefined"==typeof e&&(e={});for(var t in H)"undefined"==typeof e[t]&&(e[t]=H[t]);var n="unavailable";return window.screen&&screen.width&&screen.height&&(n=screen.width+"x"+screen.height),q&&(e.ns_alias=q),e.screen_resolution=n,e.bbc_site=W.getSite(),e.name=W.getCountername(),e.ns_ti=document.title,e.ns_c=document.characterSet?document.characterSet:document.defaultCharset,e.ns__t=(new Date).getTime(),e.ns_jspageurl=location&&location.href?location.href:document.URL,e.ns_referrer=N(),e}function N(){return encodeURI(window.orb&&window.orb.referrer?window.orb.referrer:document.referrer)}function R(e,t,n,r){if(s()){if(!J)return void(r||se.push({labels:e,callback:t,event:n}));if(0==A.length)throw Error("No data collectors available");e=D(e),Z.push(e);for(var o=0,i=0;i<A.length;i++){collector=A[i],separator=collector.separator||"&";var a=new Image;a.src=collector.url+"?"+g(e,separator),"function"==typeof t&&(a.onload=function(){o++,o==A.length&&t()})}}}function S(e){return e.split("?")[0].split("#")[0]}function $(e){if(!e.intlink_from_url)return!1;var t=N();return!t||S(e.intlink_from_url)===S(t)||(W.log("error","istats-internal-link-tracking",e),!1)}function O(){var e=w(),t={},n=(new Date).getTime();for(var r in e)e[r].expires>n&&(t[r]=e[r]);_(JSON.stringify(t))}function j(){if(!J){var e;if(s()){e=c()||r(),O();var n=w(),o={};for(var i in n)o[i]=n[i].value;m(o),J=!0;var a=v({},H);if(e&&($(e)||(e.intlink_from_url=void 0,e.intlink_ts=void 0,e.link_location=void 0),a=v(a,e),t()._linkTracked=!0),q=E(V),W.log("pageview",W.getCountername(),a),se.length>0)for(var l in se)R(se[l].labels,se[l].callback,se[l].event,!0);if(z&&z.length>0)for(var u=0;u<z.length;u++)"function"==typeof z[u]&&z[u]();z=[]}}}function F(){J=!1,z=[],Z=[],q=void 0,H={}}var K,P={version:"2.0.0"},W=P,A=[],H={},G="",J=!1,z=[],M="sa_labels",V="ckpf_echo_device_id",q=null,B="istats-notrack",Q="_istats_"+Math.random(),X={internal:!0,external:!0,download:!0,clickthrough:!0,promoimage:!0},Y={type:"",url:""},Z=[],ee=2e3,te=1e4,ne=500,re=null,oe={ignore:/.+\.(jpe?g|gif|png)$/i,webUrl:/^(\.\.?\/|\/|https?:\/\/|[^\/.:]+([\/.]|$))/i,pseudoProtocol:/^(mailto:|javascript:|about:|view-source:|data:)/i,internalUrl:/^(?:\/\/|https?:\/\/)?(?:[^.]+\.)*((bbc|bbci)(?:\.co\.uk|\.com)|doubleclick\.net)(:|\/|$)/i,storeUrl:/^https?:\/\/.*store\.bbc\.(co\.uk|com).*$/i,downloadUrl:/.+\.(pdf|te?xt|rtf|docx?|xlsx?|pptx?|od[tpsgbf]|mp[234]|m4a|mpeg|exe|dmg|zip|tgz)$/i,relativeUrl:/^(\.\.?\/|\/[^\/]|([^\/.:]+([\/.]|$)))/i,clickThrough:/^#sa-(.*)(?:-sa(.*))$/,hashLabels:/^ct_|ns_(fee|campaign|linkname|mchannel|source)=(.+?)$/,domain:/(bbc(?:\.co\.uk|\.com))(:\d+)?(\/.*)?$/i},ie={},ae={types:{"trackingfail.istats":!0,"trackingsuccess.istats":!0,"redirect.istats":!0,"cookiecreated.istats":!0}},ce={},se=[],le=[],ue=function(){var e={};for(var t in ae.types)e[t]=[];return e},fe=E(M);return e(window),fe=fe||t()._trackingCookie,I(M),P.getConfig=t,P.isReady=n,P._getLabelsFromString=i,P.isEnabled=s,P.setCountername=function(e){K=e},P.getCountername=function(){return K||(K=l()),K.match(/\.page$/)||(K+=".page"),K},P._normaliseLabelValue=u,P.setSite=function(e){G=u(e)},P.getSite=function(){return G||"string"==typeof H.bbc_site&&W.setSite(H.bbc_site),G},P.getDefaultURL=function(){try{var e=W.getCollector("default")}catch(e){return""}return e.url+"?"+g(D({}),"&")},P.track=function(e,t){if(s()){if(!X[e])throw'Given linkType, "'+e+'" is not valid.';t=t||{},t.region||(t.region=[document.body]),"undefined"==typeof t.region.push&&(t.region=[t.region]);for(var n=t.region.length;n--;){var r=t.region[n];L(r,e);var o=r[Q];o.linkTypesTracked[e]=t||{},o.trackerAttached||(!function(e){ie.attach(e,"click",function(t){ce.dispatch(e,t)})}(r),o.trackerAttached=!0)}}},P.observe=function(e,t,n){if(!ae.types[t])throw'Cannot observe: Given eventType, "'+t+'" in unknown.';"undefined"==typeof e.push&&(e=[e]);for(var r=e.length;r--;)L(e[r]),le[e[r][Q].eventsKey][t].push(n)},P._isInternal=function(e){return P._isWebUrl(e)&&(oe.relativeUrl.test(e)||oe.internalUrl.test(e))&&!oe.storeUrl.test(e)},P._isInternalCrossDomain=function(e){return P._isWebUrl(e)&&W._isInternal(e)&&P._getDomainFromHost(window.location.host)!==P._getDomainFromHost(e)},P._isExternal=function(e){return P._isWebUrl(e)&&!W._isInternal(e)},P._isDownload=function(e){return oe.webUrl.test(e)&&oe.downloadUrl.test(e)},P._isWebUrl=function(e){return oe.webUrl.test(e)&&!oe.ignore.test(e)&&!oe.pseudoProtocol.test(e)},P._getDomainFromHost=h,P._getLabelsFromHashString=c,P._createCookie=x,P._inspectTracking=function(e){return"undefined"!=typeof e&&(Y=e),Y},P.log=function(e,t,n,r){n=n||{},s()&&("pageview"!==e.toLowerCase()&&(n.ns_type="hidden",n.action_name=t,n.action_type=e),Y.type="logging actions",R(n,r))},P.addNoTrack=function(e){d(e,B)},P.removeNoTrack=function(e){p(e,B)},P.addLabels=m,P._getLabels=function(){return H},P.addStoredLabels=function(e,t){"string"==typeof e&&(e=i(o(e))),m(e);var n=(new Date).getTime()+t,r=w();for(var a in e)r[a]={value:e[a],expires:n};_(JSON.stringify(r))},ae.notify=function(e,t,n){for(var r=le[e[Q].eventsKey][t],o=0,i=r.length;o<i;o++)if("function"==typeof r[o]&&r[o](n)===!1)return!1},ie.attach=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},ie.detach=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},ie.getTarget=function(e){return e=e||window.event,e.target||e.srcElement},ce.dispatch=function(e,t){var n,r,o,i,a,c=y(ie.getTarget(t),this);c&&c.href&&(i=(new Date).getTime(),a=c.istatsTimestamp&&i-c.istatsTimestamp<ne,a||f(c,B)||(n=b(c.href),r=ce[n],o=e[Q].linkTypesTracked[n],n&&r&&o&&(c.istatsTimestamp=i,t.istats=t.istats||{},ce[n](e,c,t))))},ce.external=function(e,t,n){var r=e[Q].linkTypesTracked.external||{};r.extlink_url=t.href,r.ns_type="hidden",r.action_type="extlink",r.ns_referrer=N(),t.id&&(r.extlink_id=t.id),v(r,U(t)),r.linkLocation||(r.linkLocation=""),Y.type="external",T(n,"external",g(r),r.linkLocation,t),C(r,e,t,n)},ce.download=function(e,t,n){var r=e[Q].linkTypesTracked.download||{};r.download_url=t.href,r.ns_type="hidden",r.action_type="download",r.ns_referrer=N(),t.id&&(r.download_id=t.id),v(r,U(t)),r.linkLocation||(r.linkLocation=""),Y.type="download",T(n,"download",g(r),r.linkLocation,t),C(r,e,t,n)},ce.internal=function(e,t,n){var r=e[Q].linkTypesTracked.internal||{};if(r.intlink_from_url=location.href,r.intlink_ts=(new Date).getTime(),t.id&&(r.intlink_id=t.id),v(r,U(t)),r.linkLocation||(r.linkLocation=""),P._isInternalCrossDomain(t.href)){var o=t.href.split("#",2),i=o[0]+"#sa-"+g(r)+"-sa";o[1]&&(i+=o[1]),t.href=i}else fe=g(r),x(M,fe,te),ae.notify(e,"cookiecreated.istats",n)},P.addCollector=function(e){if("object"!=typeof e)throw new Error("Only an object can be passed in as a collector");if(!e.name)throw new Error("Collector must have a name");if(!e.url)throw new Error("Collector must have a url");return e.seperator&&(e.separator=e.seperator,delete e.seperator),A.push(e),!0},P.getCollector=function(e){for(var t=0;t<A.length;t++)if(A[t].name===e)return A[t];throw Error("Unable to find "+e+" in collectors")},P._sendData=R,P.labelsSent=function(){return Z},P.invoke=j,P._partialReset=F,P});