define("ivote/lib/ElementQuery",["jquery-1.9"],function(a){var b={},c=function(c,d,f,g,h){if(c=e(c),""!=c){var i;g||h||(i=/^([0-9]*.?[0-9]+)(px|em)$/.exec(f),null!=i&&(g=Number(i[1]),g+""!="NaN"&&(h=i[2]))),h&&(a.find.compile&&a.find.compile(c),void 0===b[c]&&(b[c]={}),void 0===b[c][d]&&(b[c][d]={}),b[c][d][f]=[g,h])}},d=function(a,d,e){if(e)b=a;else{var f,g,h;for(f in a)for(g in a[f])if("string"==typeof a[f][g])c(f,g,a[f][g]);else if("object"==typeof a[f][g])for(h=0;h<a[f][g].length;h++)c(f,g,a[f][g][h])}1==d&&i()},e=function(a){if(null==a)return"";var b="".trim;return b&&!b.call("\ufeffÂ ")?b.call(a):(a+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},f=function(a,b){var c=a.getAttribute(b);return c?(" "+c+" ").replace(/[\t\r\n]/g," "):" "},g=function(a,b,c){if(1===a.nodeType){var d=e(c);if(""!=d){var g=f(a,b);g.indexOf(" "+d+" ")<0&&a.setAttribute(b,e(g+d))}}},h=function(a,b,c){if(1===a.nodeType){var d=e(c);if(""!=d){for(var g=f(a,b),h=!1;g.indexOf(" "+d+" ")>=0;)g=g.replace(" "+d+" "," "),h=!0;h&&a.setAttribute(b,e(g))}}},i=function(){if(!ivote_noStyling){var c,d,e,f,i,j,k;for(c in b)if(i=a.find(c),i.length>0)for(d=0;d<i.length;d++){j=i[d];for(e in b[c])for(f in b[c][e])k=b[c][e][f][0],"em"==b[c][e][f][1]&&(k*=window.getEmPixels?getEmPixels(j):16),"min-width"==e&&j.offsetWidth>=k||"max-width"==e&&j.offsetWidth<=k||"min-height"==e&&j.offsetHeight>=k||"max-height"==e&&j.offsetHeight<=k?g(j,e,f):h(j,e,f)}var l=document.documentElement.className;document.documentElement.className=" "+l,document.documentElement.className=l,a(document).trigger("elementqueryrefresh")}},j=function(){i()},k=function(a){d(a,!0,!0)};return k.selectors=function(){var a,c,d,e={};for(a in b)for(c in b[a])for(d in b[a][c])void 0===e[a]&&(e[a]={}),void 0===e[a][c]&&(e[a][c]=[]),e[a][c][e[a][c].length]=d;return e},a(window).on("resize",j),k}),define("ivote/build/ivoteElementQueries",[],function(){function a(){this.getQueries=function(){return{".ivote-module__imageSize-small":{"min-width":{"550px":[550,"px"],"800px":[800,"px"],"944px":[944,"px"]},"max-width":{"943px":[943,"px"]}},".ivote-module__imageSize-medium":{"min-width":{"550px":[550,"px"],"800px":[800,"px"],"944px":[944,"px"]},"max-width":{"549px":[549,"px"],"799px":[799,"px"],"943px":[943,"px"]}},".ivote-module__content":{"min-width":{"550px":[550,"px"],"944px":[944,"px"]},"max-width":{"943px":[943,"px"]}}}}}return a}),define("ivote/view/ResponsiveView",["jquery-1.9","ivote/lib/ElementQuery","ivote/build/ivoteElementQueries"],function(a,b,c){var d=function(){var d=this;this._elementQuery,this._ivoteQueries=new c,this._imageSize,this._details,this._container,this._els_initialised=!1,this._hasRefreshed=!1,this.init=function(c){this._imageSize=c,a(document).on("elementqueryrefresh",this.onRefresh),this._elementQuery=new b(this._ivoteQueries.getQueries()),this._containerElement=a(".ivote-module"),this._containerSize=this._containerElement.width(),setInterval(function(){var b=d._containerElement.width();d._containerSize!=b&&(d._containerSize=b,a(window).trigger("resize"))},200)},this.onRefresh=function(){d._hasRefreshed=!0,d.columnConform()},this.getElements=function(){var b=a("form.ivote-form"),c=a(".ivote-result");b.is(":visible")?d._container=b:c.is(":visible")?d._container=c:d._container=!1,d._container&&(d._details=d._container.find(".vote-detail")),d._els_initialised||(d._els_initialised=!0)},this._setSameHeightForItems=function(b){var c=-1;a.each(b,function(a,b){var d=b.height();c=d>c?d:c}),a.each(b,function(a,b){b.height(c-2)})},this._setSameBoxHeight=function(b){var c=-1,d=".vote-detail__summary",e=b.find(d);e.height("auto"),a.each(e,function(b,d){var e=a(this).height();c=e>c?e:c}),a.each(e,function(b,d){a(this).height(c)})},this.columnConform=function(){if("SMALL"!=d._imageSize)return!1;if(d._els_initialised&&d._container!==!1&&d._container.is(":visible")||d.getElements(),d._container!==!1){d._details.height("auto"),this._setSameBoxHeight(d._container);var b=[],c=a(d._details[0]).offset().top;a.each(d._details,function(e,f){var g=a(f),h=g.offset();h.top!=c?(d._setSameHeightForItems(b),b=[g],c=g.offset().top):b.push(g)}),this._setSameHeightForItems(b)}}};return d}),define("ivote/model/FormValidator",[],function(){function a(){this.validateFormData=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];if(d.name&&"choice"==d.name){b.isValid=!0;break}b.isValid=!1,b.errors=new Array("no-choice-submission")}return b}}return a}),define("ivote/lib/Utility",[],function(){function a(){this.getQuerystringParam=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))}}return a}),define("ivote/view/ErrorView",["ivote/view/VoteView","ivote/lib/Logger","jquery-1.9"],function(a,b,c){function d(a){this._voteView=a,this.renderErrorMessage=function(a,b){switch(a.toString()){case"no-choice-submission":var c="noOptionChosen";break;case"400":var c="400";break;case"401":var c="401";break;case"403":var c="403";break;case"404":var c="404";b=!0;break;case"410":var c="410";b=!0;break;case"412":var c="412";b=!0;break;case"429":var c="429";break;case"500":var c="500";break;case"503":var c="503";b=!0;break;case"522":var c="522";b=!0;break;default:var c="500"}b?this._voteView.renderMessage(c,{hideOtherContent:!0,preserveExistingMessages:!1}):this._voteView.renderMessage(c,{hideOtherContent:!1,preserveExistingMessages:!1}),ivote_noStyling||this._voteView.scrollToModuleTop()}}return d}),define("ivote/model/IdentityCookie",["ivote/lib/Utility","ivote/lib/Logger"],function(a,b){function c(b){this._cookieName="IDENTITY",this._envCookieName="IDENTITY_ENV",this._cookieValue=null,this._palEnv=b,this._cookieRead=!1,this._utility=new a,this.getIdentityCookieValue=function(){return this._cookieRead||this.readIdentityCookie(),this._cookieValue},this.readIdentityCookie=function(){this._cookieRead=!0;var a=this._utility.getQuerystringParam("iVote_MockIdentityCookie");if(""!=a)return void("present"==a?this._cookieValue="MockUser|":"absent"==a&&(this._cookieValue=null));if(document.cookie){var b=this.getCookieValue(this._cookieName),c=this.getCookieValue(this._envCookieName);!b||"sandbox"!=this._palEnv&&"live"!=this._palEnv&&c&&c!=this._palEnv||(this._cookieValue=b)}},this.getUserIdentifier=function(){if(this._cookieRead||this.readIdentityCookie(),this._cookieValue){var a=this._cookieValue.split("|");return a[0]}return null},this.getCookieValue=function(a){var b=null,c=document.cookie.indexOf(" "+a+"=");if(-1==c&&(c=document.cookie.indexOf(a+"=")),-1!=c){c=document.cookie.indexOf("=",c)+1;var d=document.cookie.indexOf(";",c);-1==d&&(d=document.cookie.length),b=unescape(document.cookie.substring(c,d))}return b}}return c}),define("ivote/model/VoteForm",["ivote/model/FormValidator","ivote/view/ErrorView","ivote/lib/Logger","ivote/lib/Utility","ivote/model/IdentityCookie","jquery-1.9","relay-1"],function(a,b,c,d,e,f,g){function h(c,h){this._validator=new a,this._errorView=new b(c),this._identityCookie=new e,this._voteView=c,this._submitting=!1,this._historyCookie=h,this._$submitButton,this._utility=new d,this.processSubmission=function(a,b){if(""!=this._utility.getQuerystringParam("iVote_MockResponseCode"))return void this.mockResponse(this._utility.getQuerystringParam("iVote_MockResponseCode"));if(!this._submitting){this.startSubmitting.call(this);var c=this._validator.validateFormData(a);!0===c.isValid?this.relaySubmit(a,b):(this.afterSubmitting.call(this),this._errorView.renderErrorMessage(c.errors[0]))}},this.mockResponse=function(a){this.handleRelayResponse(a,!0)},this.relaySubmit=function(a,b){for(var c={},d=0;d<a.length;d++)c[a[d].name]=a[d].value;c.jsSubmit="true",postDataSerialised=f.toJSON(c);var e=this;require(["idcta/idcta-1","idcta/id-config"],function(a,c){a.hasCookie()?"RED"==c["bbcid-v5"]?e._relaySubmitPost(postDataSerialised,b):a.initiateTokenRefresh().then(function(){e._relaySubmitPost(postDataSerialised,b)})["catch"](function(){}):e._relaySubmitPost(postDataSerialised,b)})},this._relaySubmitPost=function(a,b){var c=this;g.post(a,b,function(a){c.afterSubmitting.call(c),c.handleRelayResponse(a)})},this.handleRelayResponse=function(a,b){"200"==a?(!b&&this._historyCookie.registerSubmission(),this._voteView.renderOpenVote(!0)):null==a?this._errorView.renderErrorMessage("522",!0):this._errorView.renderErrorMessage(a,!1)},this.startSubmitting=function(){this._submitting=!0,this._$submitButton||(this._$submitButton=f("#ivoteMainContent .vote-button")),this._$submitButton.attr("disabled","disabled")},this.afterSubmitting=function(){this._submitting=!1,this._$submitButton.removeAttr("disabled")}}return h}),function(a){"function"==typeof define&&define.amd?define("ivote/lib/jquery.cookie",["jquery-1.9"],a):a("object"==typeof exports?require("jquery-1.9"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(arguments.length>1&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join(""),document.cookie}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}),define("ivote/model/HistoryCookie",["ivote/lib/Utility","ivote/lib/Logger","jquery-1.9","ivote/lib/jquery.cookie","ivote/model/IdentityCookie"],function(a,b,c,d,e){function f(b,d){this._cookieName="ckns_IVOTE_HISTORY",this._cookieValue,this._user=d,this._utility=new a,this._vote=b,this.identityCookie=new e(window.ivote.palEnv),this._getHistoryDataObject=function(){var a={},b=c.cookie(this._cookieName);if(b)for(var d=b.split("|"),e=0;e<d.length;e++){var f=d[e].split(":"),g=f[0],h=f[1].split(",");a[g]={};for(var i=0;i<h.length;i++){var f=h[i].split("="),j=f[0],k=f[1];a[g][j]=parseInt(k,10)}}return a},this._writeHistoryDataObject=function(a){try{var b="";c.each(a,function(a,d){b+=a+":",c.each(d,function(a,c){b+=a+"="+c+","}),b=b.slice(0,-1)+"|"}),b=b.slice(0,-1),c.cookie(this._cookieName,b,{expires:30,path:"/",domain:this._getDomainName()})}catch(d){}},this.getTotalSubmissions=function(){try{var a=this._utility.getQuerystringParam("iVote_MockSubmissionQuota"),b=ivote.userId;if(""!=a){if("filled"==a)return 1;if("not_filled"==a)return 0}var c=this._getHistoryDataObject(),d=this._vote.getRequiresId()?b:"-";return c[d]&&c[d][this._vote.getShortId()]?c[d][this._vote.getShortId()]:0}catch(e){}},this.registerSubmission=function(){try{var a=this._vote.getRequiresId()?ivote.userId:"-",b=this._vote.getShortId(),c=this.getTotalSubmissions()+1,d=this._getHistoryDataObject();d[a]||(d[a]={}),d[a][b]=c,this._writeHistoryDataObject(d)}catch(e){}},this._getDomainName=function(){return"object"==typeof QUnit?"":-1!=window.location.host.indexOf("bbc.com")?"bbc.com":"bbc.co.uk"}}return f}),define("ivote/lib/MediaPlayer",["jquery-1.9"],function(a){function b(b){this._voteView=b,this._headlinePlayer,this._inlinePlayer,this._playingMediaContent,this.current=null,this._canvas=null,this._canvasSettings={radius:19,canvas_size:40,fill_color:"#ffffff",track_color:"rgba(255, 255, 255, 0.3)"},this._smpSupported=!0,this._pidsMetadata=this._voteView._vote.getPidsMetadata(),this.initialiseHeadlineMediaPlayer=function(a,b){if(this._pidsMetadata&&this._pidsMetadata[b].version){var c=this,d=this._pidsMetadata[b];require(["bump-3"],function(b){var e={product:"iplayer",playerProfile:"smp",superResponsive:!0,playlistObject:{title:d.metadata.title,holdingImageURL:"http://"+d.metadata.image,items:[{vpid:d.version.vpid}]}},f=b(a).player(e);f.bind("playing",function(a){c._playingMediaContent&&"inline"==c._playingMediaContent&&c.stopCurrentPlayer(),c._playingMediaContent="headline"}),f.bind("playlistEnded",function(a){c.stopCurrentPlayer()}),f.bind("error",function(d){c._smpSupported=!1,c._voteView.renderMessage("smpNotSupported",{hideOtherContent:!1,preserveExistingMessages:!1}),b(a).html("&nbsp;").parent().addClass("not-supported")}),f.load(),c._headlinePlayer=f})}},this.initialiseInlineMediaPlayer=function(a){var b=this;require(["bump-3"],function(c){var d={product:"iplayer",playerProfile:"smp",plugins:{player:{width:0,height:0}},autoplay:!1,ui:{miniMode:{enabled:!0},poster:{enabled:!1}}},e=c(a).player(d);e.bind("playing",function(a){b._playingMediaContent&&"headline"==b._playingMediaContent&&b.stopCurrentPlayer(),b._playingMediaContent="inline"}),e.bind("playlistEnded",function(a){b.stopCurrentPlayer()}),e.bind("playing",function(a){b.updateSnippetItemStatus(b.current,"ivote_media-playing")}),e.bind("error",function(a){c(".ivote_media-action").addClass("ivote_media-action--unavailable"),b._smpSupported=!1}),b.isCanvasSupported()&&e.bind("timeupdate",function(a){e.duration()&&b.onPlayProgress(e.duration(),e.currentTime())}),b._inlinePlayer=e,e.load()})},this.stopCurrentPlayer=function(){"headline"==this._playingMediaContent?this._headlinePlayer.stop():"inline"==this._playingMediaContent&&(this._inlinePlayer.suspend(),this.updateSnippetItemStatus(this.current,"inactive"),this._canvas&&(this.drawCanvasPlayingProgress(this._canvas.get(0).getContext("2d"),0),this._canvas=null),this.current=null),this._playingMediaContent=null},this.processInlinePlayer=function(a,b){this._smpSupported&&this._pidsMetadata&&this._pidsMetadata[b].version&&("headline"==this._playingMediaContent&&this.stopCurrentPlayer(),this.current==a?this.stopCurrentPlayer():(this.current&&this.stopCurrentPlayer(),this.updateSnippetItemStatus(a,"ivote_media-loading"),this._inlinePlayer.loadPlaylist({items:[{vpid:this._pidsMetadata[b].version.vpid}]},{autoplay:!0}),this.current=a,this.isCanvasSupported()&&this.appendCanvas(a)))},this.isCanvasSupported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},this.updateSnippetItemStatus=function(b,c){this.current&&a('*[data-segment-event-id="'+this.current+'"]').removeClass("ivote_media-loading ivote_media-playing"),"inactive"!=c&&a('*[data-segment-event-id="'+b+'"]').addClass(c)},this.appendCanvas=function(b){var c=a(".ivote_media-action.ivote_media-action--canvas");if(!c.length){var d=a(this.createCanvas());c=a('<div class="ivote_media-action ivote_media-action--canvas" />').append(d)}a('*[data-segment-event-id="'+b+'"]').find(".media-action--snippet").prepend(c.remove()),this._canvas=c.find(".ivote_canvas-el")},this.createCanvas=function(){var a=document.createElement("canvas");return a.setAttribute("width",this._canvasSettings.canvas_size),a.setAttribute("height",this._canvasSettings.canvas_size),a.className="ivote_canvas-el",a},this.onPlayProgress=function(a,b){if(this._canvas){var c=a>0?100*(b/a):0;98.5>c&&this.drawCanvasPlayingProgress(this._canvas.get(0).getContext("2d"),c)}},this.drawCanvasPlayingProgress=function(a,b){if(a===!1)return!1;b>100&&(b=100);var c=4,d=this._canvasSettings.radius,e=this._canvasSettings.canvas_size/2,f=this._canvasSettings.canvas_size/2;return a.clearRect(0,0,2*d,2*d),a.save(),b>0&&(a.beginPath(),a.lineWidth=c,a.strokeStyle=this._canvasSettings.track_color,a.arc(e,f,d-c,0,2*Math.PI,!1),a.stroke(),a.closePath(),a.restore(),a.beginPath(),a.lineWidth=c,a.strokeStyle=this._canvasSettings.fill_color,a.arc(e,f,d-c,-(Math.PI/2),Math.PI*(b/50)-Math.PI/2,!1),a.stroke(),a.closePath(),a.restore()),!0}}return b}),define("ivote/view/VoteView",["ivote/view/ResponsiveView","ivote/model/VoteForm","ivote/model/HistoryCookie","ivote/model/IdentityCookie","ivote/lib/Logger","ivote/lib/MediaPlayer","jquery-1.9","idcta/idcta-1","idcta/id-config"],function(a,b,c,d,e,f,g,h,i){function j(){this._responsiveView,this._voteForm,this._historyCookie,this._identityCookie,this._vote,this._user,this._firstInit=!0,this._firstRender=!0,this._mediaPlayer,this._opts={},this.isResultsAnimated=!1,this.init=function(d,e,f,h){this._vote=d,this._user=e,this._opts=h,this._identityCookie=f,this._historyCookie=new c(this._vote,this._user),this._voteForm=new b(this,this._historyCookie),ivote_noStyling||(this._responsiveView=new a),window.clearTimeout(ivote_loadTimerId),g("#ivote-module__LoadingMessage").addClass("hidden"),this.isOrbFigAvailable()&&this._vote.getUKOnlyVote()&&this._vote.setAvailability(window.orb.fig.geo.isUK()),this.renderIvoteWidget(),this._firstInit&&(this._firstInit=!1,this.assignFormSubmissionEvent(),BBCiDisAvailable&&this._vote.getRequiresId()&&this.updateStatusFromIdcta()),ivote_noStyling||this._responsiveView.init(this._vote.getImageSize())},this.isOrbFigAvailable=function(){return"undefined"!=typeof window.orb&&"undefined"!=typeof window.orb.fig&&"undefined"!=typeof window.orb.fig.geo},this.setVote=function(a){this._vote=a},this.getVote=function(){return this._vote},this.setUser=function(a){this._user=a},this.getUser=function(){return this._user},this.updateStatusFromIdcta=function(){var a=this.getUserId(h,i);return a?(this._setUserLoggedIn(a),this.reRenderView()):this._setUserLoggedOut(),a},this.getUserId=function(a,b){var c=!1;return"RED"!=b["bbcid-v5"]?c=a.getIdFromCookie():(this._identityCookie.readIdentityCookie(),c=this._identityCookie.getUserIdentifier()),c},this.reRenderView=function(){this.renderIvoteWidget(),"undefined"!=typeof this._responsiveView&&this._responsiveView.columnConform()},this._setUserLoggedIn=function(a){ivote.userId=a;var b=this.getUser();b.setIsLoggedIn(!0),b.setId(a)},this._setUserLoggedOut=function(){var a=this.getUser();a.setIsLoggedIn(!1)},this.renderTemplate=function(a,b){b=b?b:{};var c=g("#ivoteMainContent ."+a);b.hideOtherContent&&g("#ivoteMainContent .ivote__state.shown").removeClass("shown"),c.addClass("shown")},this.renderMessage=function(a,b){b=b?b:{};var c=this._vote.getMessage(a);if(c){var d=g("#ivoteMainContent .pre-form-messages"),e=g("#ivoteMainContent .post-form-messages");b.preserveExistingMessages||(d.empty(),e.empty());var f=b.postForm?e:d,h="";if("undefined"!=typeof c.title)b.mergeExistingMessage?g(".vote-message-box__content").append("<br><br>"+c.text):h=this._vote.renderMessageTemplate(c.classes,c.title,c.text);else{h=g('<div class="vote-message"></div>'),h.html(c.text);for(var i=0;i<c.classes.length;i++)h.addClass(c.classes[i])}f.append(h),b.hideOtherContent&&g("#ivoteMainContent .ivote__state.shown").removeClass("shown"),f.addClass("shown")}},this.renderIvoteWidget=function(){var a=this;if(1==this._vote.getUKOnlyVote()&&0==this._vote.getAvailability())this.renderMessage("ukOnly",{hideOtherContent:"PENDING"!=this._vote.getStatus(),preserveExistingMessages:!1});else{if("FINISHED"==this._vote.getStatus())this.renderFinishedVote();else if("CLOSED"==this._vote.getStatus())this.renderClosedVote();else if("SUSPENDED"==this._vote.getStatus())this.renderSuspendedVote();else if(1==this._vote.getRequiresId()){if(1==this._user.getIsLoggedIn()&&1==this._user.getIsAuthorised())this.renderVoteMainContent();else if(0==this._user.getIsLoggedIn()||0==this._user.getIsAuthorised())if(1==BBCiDisAvailable){var b={hideOtherContent:!1};"PENDING"==this._vote.getStatus()?(this.renderPendingVote(),b.preserveExistingMessages=!0,b.mergeExistingMessage=!0):b.hideOtherContent=!0,this.isNewIvoteUx()?this.renderMessage("BBCidCTAInMessage",b):this.renderTemplate("vote-login",{hideOtherContent:"PENDING"!=this._vote.getStatus()}),1==this._user.getIsLoggedIn()&&g(".vote-message--login").css("display","none")}else 0==BBCiDisAvailable&&this.renderBBCidUnavailableMessage()}else this.renderVoteMainContent();if(("AUDIO"==this._vote.getMediaType()||"VIDEO"==this._vote.getMediaType())&&this.initialiseHeadlineMediaPlayer(),"AUDIO"==this._vote.getOptionsMediaType()){var c=this._vote.getOptions()[0].getMediaMetadata();"IBROADCAST"==c?this.initialiseInlineMediaPlayer():this._opts.isFavouritePluginEnabled&&require(["plugins/musicfavourite"],function(b){g.each(a._vote.getOptions(),function(a,c){var d=g(".ivote_media-action-add-playlister[data-option-id="+c.getId()+"]:first"),e=g.extend(c.getAddFavOptions(),{appid:"radio"});b.render(d,e)})})}}this._firstRender&&(this._firstRender=!1)},this.isNewIvoteUx=function(){return g(".ivote-module").hasClass("ivote-new")},this.renderVoteMainContent=function(){switch(this._vote.getStatus()){case"OPEN":this.renderOpenVote();break;case"DRAFT":this.renderDraftVote();break;case"SUSPENDED":this.renderSuspendedVote();break;case"PENDING":this.renderPendingVote();break;case"CLOSED":this.renderClosedVote();break;case"FINISHED":this.renderFinishedVote()}},this.renderDraftVote=function(){this.renderMessage("draft",{hideOtherContent:!0,preserveExistingMessages:!1})},this.renderSuspendedVote=function(){this.renderMessage("suspended",{hideOtherContent:!0,preserveExistingMessages:!1})},this.renderPendingVote=function(){this.renderMessage("pending",{hideOtherContent:!0,preserveExistingMessages:!1}),1==this._vote.getRequiresId()&&1==this._user.getIsLoggedIn()&&this.renderMessage("pendingLoggedIn",{hideOtherContent:!1,preserveExistingMessages:!0,mergeExistingMessage:!0})},this.renderClosedVote=function(){this.renderMessage("closed",{hideOtherContent:!0,preserveExistingMessages:!1}),this.renderVoteResult()},this.renderFinishedVote=function(){this.renderMessage("closed",{hideOtherContent:!0,preserveExistingMessages:!1}),this.renderVoteResult()},this.renderOpenVote=function(a){var b=!1;totalVotes=this._historyCookie.getTotalSubmissions(),totalVotes>=this._vote.getSubmissionQuota()&&(b=!0),1==a?(this.renderVoteAcknowledgement(),0==b&&this.renderVoteAgainButton(),this.renderVoteResult(),ivote_noStyling||this.scrollToModuleTop()):0==b?this.renderForm(a):(this.renderFilledSubmissionQuotaMessage(),this.renderVoteResult())},this.scrollToModuleTop=function(){var a=this.getTopPosition();g("html, body").scrollTop(a)},this.getTopPosition=function(){return g(".ivote-module__content").offset().top+this._vote.getTopAdjustment()},this.renderVoteAgainButton=function(){var a=this;this.isNewIvoteUx()?this.renderMessage("voteAgain",{preserveExistingMessages:!0,mergeExistingMessage:!0}):this.renderTemplate("vote-message--vote-again",{hideOtherContent:!1}),g("a#voteAgain").on("click",function(b){b.preventDefault(),a.renderOpenVote(),!a._responsiveView||a._responsiveView._hasRefreshed||a._firstRender||a._responsiveView.columnConform(),this.scrollToModuleTop()})},this.renderVoteAcknowledgement=function(){this.renderMessage("thanks",{hideOtherContent:!0,preserveExistingMessages:!1})},this.renderResultTitle=function(){this.renderMessage("resultTitle",{hideOtherContent:!1,preserveExistingMessages:!0,mergeExistingMessage:!0})},this.renderFilledSubmissionQuotaMessage=function(){this.renderMessage("alreadyVoted",{hideOtherContent:!0,preserveExistingMessages:!1})},this.initialiseHeadlineMediaPlayer=function(){this._mediaPlayer||(this._mediaPlayer=new f(this)),g("<div/>",{id:"vote-media__headline-audio"}).appendTo(".vote-headline-media"),this._mediaPlayer.initialiseHeadlineMediaPlayer("#vote-media__headline-audio",this._vote.getMediaLocation())},this.initialiseInlineMediaPlayer=function(){this._mediaPlayer||(this._mediaPlayer=new f(this)),g("#vote-media__inline-audio").length||(g("<div/>",{id:"vote-media__inline-audio"}).appendTo(".vote-options-holder"),g("<div/>",{id:"vote-media__container__inline-audio"}).appendTo("#vote-media__inline-audio"),this._mediaPlayer.initialiseInlineMediaPlayer("#vote-media__container__inline-audio"))},this.renderForm=function(a){g(".voteForm input[name='choice']").attr("checked",!1),this.renderTemplate("ivote-form",{hideOtherContent:!0});var b=!1;g(".ivote-form").hasClass("ivote-result")&&(g(".ivote-form").removeClass("ivote-result"),b=!0),"AUDIO"==this._vote.getOptionsMediaType()&&this.createInlineAudioButtons(),this._responsiveView&&(b||!this._responsiveView._hasRefreshed&&!this._firstRender)&&this._responsiveView.columnConform()},this.createInlineAudioButtons=function(){var a=this;this.renderTemplate("ivote_media-actions",{hideOtherContent:!1}),g(".ivote_media-snippet-bt").off("click.ivote_audio").on("click.ivote_audio",function(b){return b.stopPropagation(),b.preventDefault(),"span"==g(b.target).get(0).tagName.toLowerCase()?option_id=g(b.target).parent().attr("data-media-option-id"):option_id=g(b.target).attr("data-media-option-id"),a._mediaPlayer.processInlinePlayer(option_id,a._vote.getOption(option_id).getMediaLocation()),!1})},this.assignFormSubmissionEvent=function(){var a=this;g(".voteForm").on("submit",function(b){if(!g("form.voteForm").hasClass("vote-result")){b.preventDefault();try{a._mediaPlayer&&a._mediaPlayer.stopCurrentPlayer(),window.bbcSnippets&&window.bbcSnippets.functions.stop(),a._voteForm.processSubmission(g(this).serializeArray(),a._vote.getSubmissionUrl())}catch(c){a.renderMessage("522",{hideOtherContent:!0,preserveExistingMessages:!1})}}})},this.renderVoteResult=function(){1==this._vote.getCanShowResults()?(this.renderResultTitle(),this.renderResultAvailable()):this.renderResultUnavailable()},this.renderResultAvailable=function(){var a=!1;g(".ivote-form").hasClass("ivote-result")||(g(".ivote-form").addClass("ivote-result"),a=!0),this.renderTemplate("ivote-form",{hideOtherContent:!1}),this._isBarAnimated()&&this._animateBars(),"AUDIO"==this._vote.getOptionsMediaType()&&this.createInlineAudioButtons(),this._responsiveView&&(a||!this._responsiveView._hasRefreshed&&!this._firstRender)&&this._responsiveView.columnConform()},this._isBarAnimated=function(){return g(".vote-graph-bar").hasClass("vote-graph-bar--animated")},this._animateBars=function(){if(0==this.isResultsAnimated){var a=g(".vote-graph-bar"),b=this;a.length>0&&(this.isResultsAnimated=!0,a.each(function(){var a=g(this),c=parseInt(a[0].style.width,10);a.width("0px"),a.find(".vote-graph-bar__result").html("0%"),g(".vote-graph-bar-wrapper").addClass("animate"),setTimeout(function(){b._setBarPercentage(a,c)},2e3)}))}},this._setBarPercentage=function(a,b){var c=this,d=600;a.animate({width:b+"%"},{duration:d,step:function(b){var d=parseInt(b,10);a.find(".vote-graph-bar__result").html(d+"%"),c._addPercentageClass(a,d),c._isPercentageFlippable(d)&&a.addClass("vote-graph-bar--flipped")},done:function(){if("undefined"!=typeof window.dispatchEvent)try{window.dispatchEvent(new Event("resize"))}catch(a){}}}).css("overflow","visible")},this._isPercentageFlippable=function(a){return a>=80},this._addPercentageClass=function(a,b){var c="percentage-single",d="percentage-double";1>b/10?(a.removeClass(d),a.addClass(c)):(a.removeClass(c),a.addClass(d))},this.renderResultUnavailable=function(){var a={hideOtherContent:!1,preserveExistingMessages:!0,postForm:!0};this.isNewIvoteUx()&&(a.mergeExistingMessage=!0),this.renderMessage("noResults",a)},this.renderBBCidUnavailableMessage=function(){this.renderMessage("BBCidUnavailable",{hideOtherContent:!0,preserveExistingMessages:!1})},this.mockJquery=function(a){g=a}}return j}),define("ivote/controller/IndexController",["ivote/view/VoteView","jquery-1.9"],function(a,b){function c(){this._voteView=new a,this._vote,this.indexAction=function(a,c,d,e,f,g){this._vote=a;var h,i=this,j=0;i._voteView.init(a,c,d,{isFavouritePluginEnabled:g});var k=f[i._vote.getStatus()];window.ivote__updateStatus=function(a){return f[i._vote.getStatus()]?null!=k.maxRequests&&j==k.maxRequests?void clearTimeout(h):(j++,b.ajax({url:f.statusRequestUrl+(a?"?Mode=initial":""),dataType:"jsonp",jsonpCallback:"iVoteStatusResult",cache:!0,success:function(a){var b=a.status,c=i._vote.getStatus();c!=b&&(i._vote.setStatus(b),k=f[i._vote.getStatus()],i._voteView.renderIvoteWidget())}}),void(h=setTimeout(window.ivote__updateStatus,1e3*k.requestInterval))):void clearTimeout(h)},!e&&k&&0!==k.maxRequests&&window.setTimeout&&window.XMLHttpRequest&&window.ivote__updateStatus(!0),b(document).trigger("ivoteinitialised")}}return c}),define("ivote/model/User",["ivote/lib/Utility","ivote/lib/Logger"],function(a,b){function c(){this._isLoggedIn,this._isAuthorised,this._id,this._utility=new a,this.setIsLoggedIn=function(a){this._isLoggedIn=a},this.setIsAuthorised=function(a){this._isAuthorised=a},this.setId=function(a){this._id=a},this.getIsLoggedIn=function(){var a=this._utility.getQuerystringParam("iVote_MockIDSignIn");return""==a?this._isLoggedIn:"signed_in"==a?!0:"signed_out"==a?!1:void 0},this.getIsAuthorised=function(){var a=this._utility.getQuerystringParam("iVote_MockIDAuthorised");return""==a?this._isAuthorised:"authorised"==a?!0:"unauthorised"==a?!1:void 0},this.getId=function(){return this._id}}return c}),define("ivote/model/Vote",["ivote/lib/Utility","ivote/lib/Logger"],function(a,b){function c(){this._utility=new a,this._id,this._shortId,this._requiresId,this._submissionQuota,this._UKOnlyVote,this._availability,this._canShowResults,this._status,this._imageSize,this._mediaType,this._mediaLocation,this._submissionUrl,this._messages,this._options,this._optionsMediaType,this._pidsMetadata=null,this._messageTemplate,this._topAdjustment=0,this.setId=function(a){this._id=a},this.setShortId=function(a){this._shortId=a},this.setRequiresId=function(a){this._requiresId=a},this.setSubmissionQuota=function(a){this._submissionQuota=a},this.setUKOnlyVote=function(a){this._UKOnlyVote=a},this.setAvailability=function(a){this._availability=a},this.setCanShowResults=function(a){this._canShowResults=a},this.setStatus=function(a){this._status=a},this.setImageSize=function(a){this._imageSize=a},this.setMediaType=function(a){this._mediaType=a},this.setMediaLocation=function(a){this._mediaLocation=a},this.setSubmissionUrl=function(a){this._submissionUrl=a},this.setMessages=function(a){this._messages=a},this.setOptions=function(a){this._options=a},this.setOptionsMediaType=function(a){this._optionsMediaType=a},this.setPidsMetadata=function(a){this._pidsMetadata=a},this.getPidsMetadata=function(){return this._pidsMetadata},this.getId=function(){return this._id},this.getShortId=function(){return this._shortId},this.getRequiresId=function(){return this._requiresId},this.getSubmissionQuota=function(){return this._submissionQuota},this.getUKOnlyVote=function(){return this._UKOnlyVote},this.getAvailability=function(){var a=this._utility.getQuerystringParam("iVote_MockGeoIp");return""==a?this._availability:"uk"==a?!0:"non-uk"==a?!1:void 0},this.getCanShowResults=function(){return this._canShowResults},this.getStatus=function(){return this._status},this.getImageSize=function(){return this._imageSize},this.getMediaType=function(){return this._mediaType},this.getMediaLocation=function(){return this._mediaLocation},this.getSubmissionUrl=function(){return this._submissionUrl},this.getMessage=function(a){return this._messages[a]},this.getOptions=function(){return this._options},this.getOption=function(a){for(var b=0;b<this._options.length;b++){var c=this._options[b];if(c.getId()==a)return c}},this.getOptionsMediaType=function(){return this._optionsMediaType},this.setMessageTemplate=function(a){this._messageTemplate=a},this.renderMessageTemplate=function(a,b,c){return this._messageTemplate.replace("{{class}}",a).replace("{{title}}",b).replace("{{message}}",c)},this.setTopAdjustment=function(a){isNaN(parseFloat(a))||(this._topAdjustment=parseFloat(a))},this.getTopAdjustment=function(){return this._topAdjustment}}return c}),define("ivote/model/VoteOption",[],function(){function a(){this._id,this._title,this._mediaLocation,this._mediaMetadata,this._mediaType,this._addFavOptions,this.setId=function(a){
this._id=a},this.setTitle=function(a){this._title=a},this.setMediaLocation=function(a){this._mediaLocation=a},this.setMediaMetadata=function(a){this._mediaMetadata=a},this.setMediaType=function(a){this._mediaType=a},this.setAddFavOptions=function(a){this._addFavOptions=a},this.getId=function(){return this._id},this.getTitle=function(){return this._title},this.getMediaLocation=function(){return this._mediaLocation},this.getMediaMetadata=function(){return this._mediaMetadata},this.getMediaType=function(){return this._mediaType},this.getAddFavOptions=function(){return this._addFavOptions}}return a}),define("ivote/lib/jquery.json-2.4.min",["jquery-1.9"],function($){!function($){"use strict";var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},hasOwn=Object.prototype.hasOwnProperty;$.toJSON="object"==typeof JSON&&JSON.stringify?JSON.stringify:function(a){if(null===a)return"null";var b,c,d,e,f=$.type(a);if("undefined"===f)return void 0;if("number"===f||"boolean"===f)return String(a);if("string"===f)return $.quoteString(a);if("function"==typeof a.toJSON)return $.toJSON(a.toJSON());if("date"===f){var g=a.getUTCMonth()+1,h=a.getUTCDate(),i=a.getUTCFullYear(),j=a.getUTCHours(),k=a.getUTCMinutes(),l=a.getUTCSeconds(),m=a.getUTCMilliseconds();return 10>g&&(g="0"+g),10>h&&(h="0"+h),10>j&&(j="0"+j),10>k&&(k="0"+k),10>l&&(l="0"+l),100>m&&(m="0"+m),10>m&&(m="0"+m),'"'+i+"-"+g+"-"+h+"T"+j+":"+k+":"+l+"."+m+'Z"'}if(b=[],$.isArray(a)){for(c=0;c<a.length;c++)b.push($.toJSON(a[c])||"null");return"["+b.join(",")+"]"}if("object"==typeof a){for(c in a)if(hasOwn.call(a,c)){if(f=typeof c,"number"===f)d='"'+c+'"';else{if("string"!==f)continue;d=$.quoteString(c)}f=typeof a[c],"function"!==f&&"undefined"!==f&&(e=$.toJSON(a[c]),b.push(d+":"+e))}return"{"+b.join(",")+"}"}},$.evalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){return eval("("+str+")")},$.secureEvalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+str+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(a){return a.match(escape)?'"'+a.replace(escape,function(a){var b=meta[a];return"string"==typeof b?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})+'"':'"'+a+'"'}}($)}),define("ivote-bootstrap",["ivote/view/VoteView","ivote/view/ResponsiveView","ivote/view/ErrorView","ivote/controller/IndexController","ivote/model/FormValidator","ivote/model/VoteForm","ivote/model/User","ivote/model/Vote","ivote/model/VoteOption","ivote/model/HistoryCookie","ivote/model/IdentityCookie","ivote/lib/MediaPlayer","ivote/lib/Logger","ivote/lib/Utility","ivote/lib/ElementQuery","ivote/build/ivoteElementQueries","ivote/lib/jquery.json-2.4.min","jquery-1.9"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){return{IndexController:d,User:g,Vote:h,VoteOption:i,IdentityCookie:k}});